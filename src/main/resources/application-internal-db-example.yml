# Example configuration for Internal Database IDP
# Copy this to your application.yml and customize as needed

firefly:
  security-center:
    idp:
      # Set provider to 'internal-db' to use this IDP implementation
      provider: internal-db
      
      # Internal Database IDP Configuration
      internal-db:
        jwt:
          # REQUIRED: JWT secret key - Must be at least 32 characters (256 bits)
          # IMPORTANT: Change this to a secure random value in production
          # Generate with: openssl rand -base64 32
          secret: "${JWT_SECRET:your-very-secure-secret-key-min-256-bits-32-chars!}"
          
          # JWT issuer claim - identifies who issued the token
          issuer: "firefly-banking-platform"
          
          # Access token expiration in milliseconds (default: 15 minutes)
          access-token-expiration: 900000
          
          # Refresh token expiration in milliseconds (default: 7 days)
          refresh-token-expiration: 604800000

# Spring R2DBC Configuration for reactive database access
spring:
  r2dbc:
    # R2DBC connection URL for PostgreSQL
    url: r2dbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:firefly}
    
    # Database credentials
    username: ${DB_USERNAME:firefly_user}
    password: ${DB_PASSWORD}
    
    # Connection pool settings
    pool:
      initial-size: 10
      max-size: 30
      max-idle-time: 30m
      validation-query: SELECT 1

  # Flyway configuration for database migrations
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    schemas: public
    table: flyway_schema_history
    
  # JDBC DataSource (required for Flyway migrations)
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:firefly}
    username: ${DB_USERNAME:firefly_user}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver

# Logging configuration
logging:
  level:
    com.firefly.idp.internaldb: DEBUG
    org.springframework.r2dbc: DEBUG
    io.r2dbc: DEBUG
    org.flywaydb: INFO

# Server configuration
server:
  port: 8080
  
# Actuator endpoints (optional)
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
